no---
title: "Project 1"
author: "Fadumo Hussein"
date: "2023-02-09"
output: html_document
---

## Loading packages 

```{r}
#N Install
install.packages("tm")  # for text mining
install.packages("SnowballC") # for text stemming
install.packages("wordcloud") # word-cloud generator 
install.packages("RColorBrewer") # color palettes
install.packages("syuzhet") # for sentiment analysis
install.packages("ggplot2") # for plotting graphs
# Load
library("tm")
library("SnowballC")
library("wordcloud")
library("RColorBrewer")
library("syuzhet")
library("ggplot2")
library("readr")
library("tidyverse")
library("mice")
```

## Upload data 
```{r}
book_spoilers <-read.csv("book_spoilers.csv")
```

## Data Preparation 
```{r}

#Subset variables of interest 
reviews <- book_spoilers[ c("review_sentences", "rating", "has_spoiler", "book_id") ]
head(reviews)

#Remove NAs from the dataset 
md.pattern(reviews, rotate.names = TRUE)
reviews_2 <- reviews[complete.cases(reviews), ]
md.pattern(reviews_2, rotate.names = TRUE)
head(reviews_2)

#Factor the variables 

reviews_2$has_spoiler  <- fct_collapse(reviews_2$has_spoiler,
                           True = "Yes", 
                           False ="No")

table(reviews_2$has_spoiler)

```

#New Columns 
```{r}
#We have multiple ratings for the same book, function creates a column that shows thh average rating of each book 
review_3 <- reviews_2 %>%
 group_by(book_id) %>%
  mutate(average_rating = mean(ratings)) %>%
  as.data.frame()
review_3 

# This column assess whether the mean of the book ratings is higher than four (The ratings 4 and 5 are above while the rest of the variables are below ) 

review_3 <- review_3 %>% 
  left_join(review_3) %>% 
  mutate(above_average = if_else(4 >= average_rating, "Yes", "No"))
```


## Cleaning up Text Data
```{r}
# Remove common words, puncutation, white, space,  

review_corpus = VCorpus(VectorSource(reviews_2$review_text))
review_corpus = tm_map(review_corpus, content_transformer(tolower))
review_corpus = tm_map(review_corpus, removeNumbers)
review_corpus = tm_map(review_corpus, removePunctuation)
review_corpus = tm_map(review_corpus, removeWords, c("the", "and", stopwords("english")))
review_corpus =  tm_map(review_corpus, stripWhitespace)
review_corpus <- tm_map(review_corpus, stemDocument)
inspect(review_corpus[2])


#Breaking down each sentence to words 
token <- review_corpus %>% unnest_tokens(word,review_sentences)


(head(get_sentiments("afinn"),10))
review_sentiment <- token %>% inner_join(get_sentiments("afinn"))


# summarise the sentiment value of each review
review_sentiment <- review_sentiment %>% group_by(review_sentences, rating, has_spoiler, book_id) %>% 
  summarise(value = sum(value)) %>% ungroup()

(head(review_sentiment,10))
```

#One hot encode 
```{r}
#This basically makes our non numeric variables a binary 0 or 1 

review_sentiment_1h <- one_hot(as.data.table(review_sentiment),cols = "has_spoiler", "above_average",sparsifyNAs = TRUE,naCols = FALSE,dropCols = TRUE,dropUnusedLevels = TRUE)



```


